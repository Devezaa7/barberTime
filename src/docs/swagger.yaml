openapi: 3.0.3
info:
  title: BarberTime API
  description: |
    üíà **Sistema completo de agendamento para barbearias modernas**
    
    O BarberTime √© uma solu√ß√£o completa para gest√£o de barbearias, permitindo:
    - Agendamentos online 24/7
    - Controle de servi√ßos e pre√ßos
    - Gest√£o de barbeiros e clientes
    - Hist√≥rico detalhado de atendimentos
    
    ## Autentica√ß√£o
    
    A maioria das rotas requer autentica√ß√£o via JWT. Para obter um token:
    1. Fa√ßa login atrav√©s do endpoint `/api/auth/login`
    2. Use o token retornado no header `Authorization: Bearer {token}`
    
    ## Tipos de Usu√°rio
    
    - **ADMIN**: Acesso total ao sistema
    - **BARBEIRO**: Visualiza e gerencia seus agendamentos
    - **CLIENTE**: Cria e gerencia seus pr√≥prios agendamentos
    
    ## Contato
    - üìß Email: contato@barbertime.com
    - üì± Telefone: +55 31 7184-0575
  version: 1.0.0
  contact:
    name: Squad One - BarberTime
    email: contato@barbertime.com
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC

servers:
  - url: http://localhost:3000/api
    description: Servidor de Desenvolvimento
  - url: https://api.barbertime.com/api
    description: Servidor de Produ√ß√£o

tags:
  - name: Autentica√ß√£o
    description: Endpoints de autentica√ß√£o e gerenciamento de sess√£o
  - name: Usu√°rios
    description: Gerenciamento de usu√°rios (clientes, barbeiros e admins)
  - name: Servi√ßos
    description: Cat√°logo de servi√ßos da barbearia
  - name: Agendamentos
    description: Sistema de agendamentos e reservas

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT obtido atrav√©s do login

  schemas:
    # === SCHEMAS DE USU√ÅRIO ===
    Usuario:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        nome:
          type: string
          example: "Jo√£o Silva"
        email:
          type: string
          format: email
          example: "joao@email.com"
        telefone:
          type: string
          example: "11999999999"
        tipo:
          type: string
          enum: [ADMIN, BARBEIRO, CLIENTE]
          example: "CLIENTE"
        ativo:
          type: boolean
          example: true
        criadoEm:
          type: string
          format: date-time
          example: "2025-12-16T10:00:00.000Z"
        atualizadoEm:
          type: string
          format: date-time
          example: "2025-12-16T10:00:00.000Z"

    UsuarioComAgendamentos:
      allOf:
        - $ref: '#/components/schemas/Usuario'
        - type: object
          properties:
            agendamentos:
              type: array
              items:
                $ref: '#/components/schemas/Agendamento'
            servicosCriados:
              type: array
              items:
                $ref: '#/components/schemas/Servico'

    # === SCHEMAS DE SERVI√áO ===
    Servico:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "660e8400-e29b-41d4-a716-446655440001"
        nome:
          type: string
          example: "Corte Degrad√™"
        descricao:
          type: string
          example: "Corte moderno com degrad√™ profissional"
        preco:
          type: number
          format: float
          example: 45.00
        duracao:
          type: integer
          description: Dura√ß√£o em minutos
          example: 40
        barbeiroId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        barbeiro:
          $ref: '#/components/schemas/Usuario'
        ativo:
          type: boolean
          example: true
        criadoEm:
          type: string
          format: date-time
        atualizadoEm:
          type: string
          format: date-time

    # === SCHEMAS DE AGENDAMENTO ===
    Agendamento:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "770e8400-e29b-41d4-a716-446655440002"
        dataHora:
          type: string
          format: date-time
          example: "2025-12-20T10:00:00.000Z"
        status:
          type: string
          enum: [PENDENTE, CONFIRMADO, CANCELADO, CONCLUIDO]
          example: "PENDENTE"
        observacao:
          type: string
          nullable: true
          example: "Primeira vez na barbearia"
        clienteId:
          type: string
          format: uuid
        cliente:
          $ref: '#/components/schemas/Usuario'
        barbeiroId:
          type: string
          format: uuid
        barbeiro:
          $ref: '#/components/schemas/Usuario'
        servicoId:
          type: string
          format: uuid
        servico:
          $ref: '#/components/schemas/Servico'
        criadoEm:
          type: string
          format: date-time
        atualizadoEm:
          type: string
          format: date-time

    # === SCHEMAS DE REQUEST ===
    LoginRequest:
      type: object
      required:
        - email
        - senha
      properties:
        email:
          type: string
          format: email
          example: "admin@barbertime.com"
        senha:
          type: string
          format: password
          example: "senha123"

    RegisterRequest:
      type: object
      required:
        - nome
        - email
        - telefone
        - senha
        - tipo
      properties:
        nome:
          type: string
          minLength: 3
          example: "Jo√£o Silva"
        email:
          type: string
          format: email
          example: "joao@email.com"
        telefone:
          type: string
          pattern: '^\d{10,11}$'
          example: "11999999999"
        senha:
          type: string
          format: password
          minLength: 6
          example: "senha123"
        tipo:
          type: string
          enum: [ADMIN, BARBEIRO, CLIENTE]
          example: "CLIENTE"

    CreateUsuarioRequest:
      type: object
      required:
        - nome
        - email
        - telefone
        - senha
        - tipo
      properties:
        nome:
          type: string
          example: "Maria Santos"
        email:
          type: string
          format: email
          example: "maria@email.com"
        telefone:
          type: string
          example: "11988888888"
        senha:
          type: string
          format: password
          example: "senha123"
        tipo:
          type: string
          enum: [ADMIN, BARBEIRO, CLIENTE]
          example: "BARBEIRO"

    UpdateUsuarioRequest:
      type: object
      properties:
        nome:
          type: string
          example: "Jo√£o da Silva Santos"
        telefone:
          type: string
          example: "11988888888"
        senha:
          type: string
          format: password
          example: "novaSenha123"

    CreateServicoRequest:
      type: object
      required:
        - nome
        - preco
        - duracao
        - barbeiroId
      properties:
        nome:
          type: string
          example: "Corte Degrad√™"
        descricao:
          type: string
          example: "Corte moderno com degrad√™ profissional"
        preco:
          type: number
          format: float
          minimum: 0
          example: 45.00
        duracao:
          type: integer
          minimum: 15
          example: 40
        barbeiroId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"

    UpdateServicoRequest:
      type: object
      properties:
        nome:
          type: string
          example: "Corte Degrad√™ Premium"
        descricao:
          type: string
          example: "Corte moderno com degrad√™ profissional e finaliza√ß√£o"
        preco:
          type: number
          format: float
          example: 50.00
        duracao:
          type: integer
          example: 45

    CreateAgendamentoRequest:
      type: object
      required:
        - dataHora
        - servicoId
        - barbeiroId
      properties:
        dataHora:
          type: string
          format: date-time
          example: "2025-12-20T10:00:00.000Z"
        servicoId:
          type: string
          format: uuid
          example: "660e8400-e29b-41d4-a716-446655440001"
        barbeiroId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        observacao:
          type: string
          example: "Primeira vez na barbearia"

    UpdateAgendamentoRequest:
      type: object
      properties:
        dataHora:
          type: string
          format: date-time
          example: "2025-12-20T14:00:00.000Z"
        status:
          type: string
          enum: [PENDENTE, CONFIRMADO, CANCELADO, CONCLUIDO]
          example: "CONFIRMADO"
        observacao:
          type: string
          example: "Cliente confirmou presen√ßa"

    # === SCHEMAS DE RESPONSE ===
    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        usuario:
          $ref: '#/components/schemas/Usuario'

    PaginatedUsuarios:
      type: object
      properties:
        usuarios:
          type: array
          items:
            $ref: '#/components/schemas/Usuario'
        total:
          type: integer
          example: 50
        page:
          type: integer
          example: 1
        perPage:
          type: integer
          example: 10
        totalPages:
          type: integer
          example: 5

    PaginatedServicos:
      type: object
      properties:
        servicos:
          type: array
          items:
            $ref: '#/components/schemas/Servico'
        total:
          type: integer
          example: 20
        page:
          type: integer
          example: 1
        perPage:
          type: integer
          example: 10
        totalPages:
          type: integer
          example: 2

    PaginatedAgendamentos:
      type: object
      properties:
        agendamentos:
          type: array
          items:
            $ref: '#/components/schemas/Agendamento'
        total:
          type: integer
          example: 100
        page:
          type: integer
          example: 1
        perPage:
          type: integer
          example: 10
        totalPages:
          type: integer
          example: 10

    ErrorResponse:
      type: object
      properties:
        erro:
          type: string
          example: "Erro ao processar requisi√ß√£o"
        detalhes:
          type: string
          example: "Detalhes t√©cnicos do erro"

paths:
  # ==================== AUTENTICA√á√ÉO ====================
  /auth/login:
    post:
      tags:
        - Autentica√ß√£o
      summary: Login de usu√°rio
      description: Autentica um usu√°rio e retorna um token JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Dados inv√°lidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Credenciais inv√°lidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      tags:
        - Autentica√ß√£o
      summary: Registro de novo usu√°rio
      description: Cria uma nova conta de usu√°rio no sistema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Usu√°rio criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Dados inv√°lidos ou email j√° cadastrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/me:
    get:
      tags:
        - Autentica√ß√£o
      summary: Obter usu√°rio autenticado
      description: Retorna os dados do usu√°rio atualmente autenticado
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Dados do usu√°rio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '401':
          description: Token inv√°lido ou ausente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ==================== USU√ÅRIOS ====================
  /usuarios:
    get:
      tags:
        - Usu√°rios
      summary: Listar todos os usu√°rios
      description: Retorna lista paginada de usu√°rios (requer autentica√ß√£o)
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: N√∫mero da p√°gina
        - name: perPage
          in: query
          schema:
            type: integer
            default: 10
          description: Itens por p√°gina
        - name: tipo
          in: query
          schema:
            type: string
            enum: [ADMIN, BARBEIRO, CLIENTE]
          description: Filtrar por tipo de usu√°rio
      responses:
        '200':
          description: Lista de usu√°rios
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedUsuarios'
        '401':
          description: N√£o autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Usu√°rios
      summary: Criar novo usu√°rio
      description: Cria um novo usu√°rio no sistema (requer permiss√£o de ADMIN)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUsuarioRequest'
      responses:
        '201':
          description: Usu√°rio criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '400':
          description: Dados inv√°lidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o

  /usuarios/{id}:
    get:
      tags:
        - Usu√°rios
      summary: Obter usu√°rio por ID
      description: Retorna os dados de um usu√°rio espec√≠fico
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usu√°rio
      responses:
        '200':
          description: Dados do usu√°rio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsuarioComAgendamentos'
        '401':
          description: N√£o autenticado
        '404':
          description: Usu√°rio n√£o encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Usu√°rios
      summary: Atualizar usu√°rio
      description: Atualiza os dados de um usu√°rio existente
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usu√°rio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUsuarioRequest'
      responses:
        '200':
          description: Usu√°rio atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '400':
          description: Dados inv√°lidos
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Usu√°rio n√£o encontrado

    delete:
      tags:
        - Usu√°rios
      summary: Deletar usu√°rio
      description: Remove um usu√°rio do sistema (soft delete)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID do usu√°rio
      responses:
        '200':
          description: Usu√°rio deletado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  mensagem:
                    type: string
                    example: "Usu√°rio deletado com sucesso"
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Usu√°rio n√£o encontrado

  # ==================== SERVI√áOS ====================
  /servicos:
    get:
      tags:
        - Servi√ßos
      summary: Listar todos os servi√ßos
      description: Retorna lista paginada de servi√ßos dispon√≠veis
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            default: 10
        - name: barbeiroId
          in: query
          schema:
            type: string
            format: uuid
          description: Filtrar servi√ßos por barbeiro
      responses:
        '200':
          description: Lista de servi√ßos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedServicos'

    post:
      tags:
        - Servi√ßos
      summary: Criar novo servi√ßo
      description: Adiciona um novo servi√ßo ao cat√°logo (requer permiss√£o de ADMIN)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateServicoRequest'
      responses:
        '201':
          description: Servi√ßo criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Servico'
        '400':
          description: Dados inv√°lidos
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o

  /servicos/{id}:
    get:
      tags:
        - Servi√ßos
      summary: Obter servi√ßo por ID
      description: Retorna os detalhes de um servi√ßo espec√≠fico
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados do servi√ßo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Servico'
        '404':
          description: Servi√ßo n√£o encontrado

    put:
      tags:
        - Servi√ßos
      summary: Atualizar servi√ßo
      description: Atualiza os dados de um servi√ßo existente (requer permiss√£o de ADMIN)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateServicoRequest'
      responses:
        '200':
          description: Servi√ßo atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Servico'
        '400':
          description: Dados inv√°lidos
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Servi√ßo n√£o encontrado

    delete:
      tags:
        - Servi√ßos
      summary: Deletar servi√ßo
      description: Remove um servi√ßo do cat√°logo (soft delete, requer ADMIN)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Servi√ßo deletado com sucesso
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Servi√ßo n√£o encontrado

  # ==================== AGENDAMENTOS ====================
  /agendamentos:
    get:
      tags:
        - Agendamentos
      summary: Listar agendamentos
      description: |
        Retorna lista paginada de agendamentos.
        - CLIENTE: v√™ apenas seus agendamentos
        - BARBEIRO: v√™ apenas agendamentos com ele
        - ADMIN: v√™ todos os agendamentos
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: perPage
          in: query
          schema:
            type: integer
            default: 10
        - name: clienteId
          in: query
          schema:
            type: string
            format: uuid
          description: Filtrar por cliente
        - name: barbeiroId
          in: query
          schema:
            type: string
            format: uuid
          description: Filtrar por barbeiro
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDENTE, CONFIRMADO, CANCELADO, CONCLUIDO]
          description: Filtrar por status
        - name: dataInicio
          in: query
          schema:
            type: string
            format: date
          description: Filtrar a partir desta data
        - name: dataFim
          in: query
          schema:
            type: string
            format: date
          description: Filtrar at√© esta data
      responses:
        '200':
          description: Lista de agendamentos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAgendamentos'
        '401':
          description: N√£o autenticado

    post:
      tags:
        - Agendamentos
      summary: Criar novo agendamento
      description: Cria um novo agendamento na barbearia
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgendamentoRequest'
      responses:
        '201':
          description: Agendamento criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agendamento'
        '400':
          description: Dados inv√°lidos ou conflito de hor√°rio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                erro: "Conflito de hor√°rio"
                detalhes: "J√° existe um agendamento para este barbeiro neste hor√°rio"
        '401':
          description: N√£o autenticado

  /agendamentos/{id}:
    get:
      tags:
        - Agendamentos
      summary: Obter agendamento por ID
      description: Retorna os detalhes de um agendamento espec√≠fico
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Dados do agendamento
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agendamento'
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o para visualizar este agendamento
        '404':
          description: Agendamento n√£o encontrado

    put:
      tags:
        - Agendamentos
      summary: Atualizar agendamento
      description: |
        Atualiza os dados de um agendamento.
        - CLIENTE: pode atualizar seus agendamentos (exceto status)
        - BARBEIRO: pode atualizar status de seus agendamentos
        - ADMIN: pode atualizar qualquer coisa
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgendamentoRequest'
      responses:
        '200':
          description: Agendamento atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agendamento'
        '400':
          description: Dados inv√°lidos ou conflito de hor√°rio
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Agendamento n√£o encontrado

    delete:
      tags:
        - Agendamentos
      summary: Cancelar agendamento
      description: |
        Cancela um agendamento (soft delete).
        - CLIENTE: pode cancelar seus pr√≥prios agendamentos
        - ADMIN: pode cancelar qualquer agendamento
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Agendamento cancelado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  mensagem:
                    type: string
                    example: "Agendamento cancelado com sucesso"
        '401':
          description: N√£o autenticado
        '403':
          description: Sem permiss√£o
        '404':
          description: Agendamento n√£o encontrado